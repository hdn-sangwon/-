<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>TC ê³ ê° ë¬¸ì˜ì‚¬í•­</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    form input, form select {
      margin: 5px;
      padding: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #f3f3f3;
    }
    .status-done { background-color: #c8f7c5; }
    .status-progress { background-color: #ffeaa7; }
    button {
      padding: 5px 10px;
    }
    #form-wrapper {
      border: 5px solid #999;
      border-radius: 10px;
      padding: 15px;
      background-color: #f9f9f9;
      margin-bottom: 20px;
    }

#filter-wrapper {
      padding: 0;
      margin-bottom: 10px;
    }
  td select {
    padding: 5px 8px;
    font-size: 13px;
    min-width: 50px;
  }
#month-filter,
#week-filter {
  font-size: 13px;
  padding: 5px 8px;
  font-family: sans-serif;
}
#search-issue,
#search-device {
  width: 200px;   
  padding: 6px;
  font-size: 14px;
}
  </style>
</head>
<body>

<div id="form-wrapper">
  <h2>ë¬¸ì˜ì‚¬í•­ ë“±ë¡</h2>
  <form id="cs-form">
<fieldset style="border: 1px solid #aaa; padding: 5px; margin-bottom: 5px;">
  <legend>ìš”ì²­ì ì •ë³´</legend>
  <input type="text" id="req-company" placeholder="ìš”ì²­ íšŒì‚¬" required />
  <input type="text" id="req-name" placeholder="ìš”ì²­ìëª…" required />
  <input type="text" id="req-phone" placeholder="ìš”ì²­ì ì „í™”ë²ˆí˜¸" required />
</fieldset>
<fieldset style="border: 1px solid #aaa; padding: 5px; margin-bottom: 5px;">
  <legend>ê³ ê°ì‚¬ ì •ë³´</legend>
    <input type="text" id="client-company" placeholder="ê³ ê°ì‚¬" required />
    <input type="text" id="client-name" placeholder="ê³ ê°ëª…" required />
    <input type="text" id="client-phone" placeholder="ê³ ê°ì‚¬ ì „í™”ë²ˆí˜¸" required />
</fieldset>
<fieldset style="border: 1px solid #aaa; padding: 5px; margin-bottom: 5px;">
  <legend>ì´ìŠˆ ì •ë³´</legend>
    <input type="text" id="device" placeholder="ì¥ë¹„ëª…" required />
    <input type="text" id="issue" placeholder="ì´ìŠˆ ë‚´ìš©" required />
    <input type="text" id="response" placeholder="ëŒ€ì‘ ë‚´ìš©" required />
    <select id="status" required>
</fieldset>
      <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
      <option value="ì™„ë£Œ">ì™„ë£Œ</option>
    </select>
    <input type="file" id="attachment" accept=".txt" />
    <button type="submit">ë“±ë¡</button>
  </form>
</div>

<div id="main-wrapper" style="border: 5px solid #999; border-radius: 10px; padding: 15px; background-color: #f9f9f9; margin-bottom: 20px;">
<div id="filter-wrapper">
  
<label for="month-filter">ì›”ë³„ ì¡°íšŒ: 
  <select id="month-filter" onchange="filterTable()">
    <option value="">ì „ì²´</option>
    <option value="2025-01">2025ë…„ 1ì›”</option>
    <option value="2025-02">2025ë…„ 2ì›”</option>
    <option value="2025-03">2025ë…„ 3ì›”</option>
    <option value="2025-04">2025ë…„ 4ì›”</option>
    <option value="2025-05">2025ë…„ 5ì›”</option>
    <option value="2025-06">2025ë…„ 6ì›”</option>
    <option value="2025-07">2025ë…„ 7ì›”</option>
    <option value="2025-08">2025ë…„ 8ì›”</option>
    <option value="2025-09">2025ë…„ 9ì›”</option>
    <option value="2025-10">2025ë…„ 10ì›”</option>
    <option value="2025-11">2025ë…„ 11ì›”</option>
    <option value="2025-12">2025ë…„ 12ì›”</option>
  </select>
</label>

<label for="week-filter" style="margin-left: 20px;">ì£¼ë³„ ì¡°íšŒ: 
  <input type="week" id="week-filter" onchange="filterTable()" />
</label>

  <h2>ğŸ“‹ ë¬¸ì˜ì‚¬í•­ ë‚´ì—­</h2>
  <div id="filter-section">
    <input type="text" id="search-issue" placeholder="ì´ìŠˆ ë‚´ìš© ê²€ìƒ‰" />
    <input type="text" id="search-device" placeholder="ì¥ë¹„ëª… ê²€ìƒ‰" />
    <button onclick="filterTable()">ğŸ” ê²€ìƒ‰</button>
    <label>ì‹œì‘ì¼: <input type="date" id="start-date"></label>
    <label>ì¢…ë£Œì¼: <input type="date" id="end-date"></label>
    <button onclick="downloadExcel()">ğŸ“¤ Excel ë‹¤ìš´ë¡œë“œ</button>
  </div>

  <table id="cs-table">
    <thead>
      <tr>
        <th>ë‚ ì§œ</th>
        <th>ìš”ì²­ íšŒì‚¬</th>
        <th>ìš”ì²­ìëª…</th>
        <th>ìš”ì²­ì ì „í™”ë²ˆí˜¸</th>
        <th>ê³ ê°ì‚¬</th>
        <th>ê³ ê°ëª…</th>
        <th>ê³ ê°ì‚¬ ì „í™”ë²ˆí˜¸</th>
        <th>ì¥ë¹„ëª…</th>
        <th>ì´ìŠˆ ë‚´ìš©</th>
        <th>ëŒ€ì‘ ë‚´ìš©</th>
        <th>Tech-support</th>
        <th>ì²˜ë¦¬ ì—¬ë¶€</th>
        <th>ì‚­ì œ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const form = document.getElementById('cs-form');
const tableBody = document.querySelector('#cs-table tbody');
const searchInput = document.getElementById('search-issue');
const startDateInput = document.getElementById('start-date');
const endDateInput = document.getElementById('end-date');
const LOCAL_KEY = "cs_data";

form.addEventListener('submit', function (e) {
  const fileInput = document.getElementById("attachment");
  const file = fileInput.files[0];
  let fileName = "";
  let fileURL = "";
  if (file) {
    fileName = file.name;
    fileURL = URL.createObjectURL(file);
  }

  e.preventDefault();

  const reqCompany = document.getElementById('req-company').value;
  const reqName = document.getElementById('req-name').value;
  const reqPhone = document.getElementById('req-phone').value;
  const cliCompany = document.getElementById('client-company').value;
  const cliName = document.getElementById('client-name').value;
  const cliPhone = document.getElementById('client-phone').value;
  const device = document.getElementById('device').value;
  const issue = document.getElementById('issue').value;
  const response = document.getElementById('response').value;
  const status = document.getElementById('status').value;
  const date = new Date().toISOString().split("T")[0];

  const newRow = document.createElement('tr');
  newRow.className = status === "ì™„ë£Œ" ? "status-done" : "status-progress";
  newRow.innerHTML = `
    <td>${date}</td>
    <td contenteditable="true">${reqCompany}</td>
    <td contenteditable="true">${reqName}</td>
    <td contenteditable="true">${reqPhone}</td>
    <td contenteditable="true">${cliCompany}</td>
    <td contenteditable="true">${cliName}</td>
    <td contenteditable="true">${cliPhone}</td>
    <td contenteditable="true">${device}</td>
    <td contenteditable="true">${issue}</td>
    <td contenteditable="true">${response}</td>
    
<td>${fileName ? `<a href="${fileURL}" download="${fileName}">${fileName}</a>` : ""}</td>
<td>
  <select onchange="updateStatus(this)">
    <option value="ì§„í–‰ì¤‘" ${status === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
    <option value="ì™„ë£Œ" ${status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
  </select>
</td>

    <td><button onclick="deleteRow(this)">ì‚­ì œ</button></td>
  `;
  tableBody.appendChild(newRow);
  saveData();
  form.reset();
  filterTable();
});


function updateStatus(select) {
  const row = select.closest("tr");
  row.className = select.value === "ì™„ë£Œ" ? "status-done" : "status-progress";
  saveData();
}

function saveData() {

  const rows = Array.from(tableBody.children).map(row => {
    return Array.from(row.cells).slice(0, 12).map((cell, idx) => {
      if (idx === 12) {
        const select = cell.querySelector('select');
        return select ? select.value : cell.textContent;
      }
      return cell.textContent;
    });
  });
  localStorage.setItem(LOCAL_KEY, JSON.stringify(rows));
}

function loadData() {
  const data = JSON.parse(localStorage.getItem(LOCAL_KEY) || "[]");
  data.forEach(entry => {
    const newRow = document.createElement('tr');
    newRow.className = entry[10] === "ì™„ë£Œ" ? "status-done" : "status-progress";
    newRow.innerHTML = `
      <td>${entry[0]}</td>
      <td contenteditable="true">${entry[1]}</td>
      <td contenteditable="true">${entry[2]}</td>
      <td contenteditable="true">${entry[3]}</td>
      <td contenteditable="true">${entry[4]}</td>
      <td contenteditable="true">${entry[5]}</td>
      <td contenteditable="true">${entry[6]}</td>
      <td contenteditable="true">${entry[7]}</td>
      <td contenteditable="true">${entry[8]}</td>
      <td contenteditable="true">${entry[9]}</td>
      
<td contenteditable="true">${entry[11]}</td>
<td>
  <select onchange="updateStatus(this)">
    <option value="ì§„í–‰ì¤‘" ${entry[12] === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
    <option value="ì™„ë£Œ" ${entry[12] === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
  </select>
</td>

      <td><button onclick="deleteRow(this)">ì‚­ì œ</button></td>
    `;
    tableBody.appendChild(newRow);
  });
}

function filterTable() {
  const search = searchInput.value.toLowerCase().trim();
  const searchDevice = document.getElementById('search-device').value.toLowerCase().trim();
  const start = startDateInput.value;
  const end = endDateInput.value;
  Array.from(tableBody.rows).forEach(row => {
    const date = row.cells[0].textContent;
    const device = row.cells[7].textContent.toLowerCase();
    const issue = row.cells[8].textContent.toLowerCase();
    const matchSearch = issue.includes(search);
    const matchDevice = device.includes(searchDevice);
    const matchStart = !start || date >= start;
    const matchEnd = !end || date <= end;
    const month = document.getElementById('month-filter').value;
    const matchMonth = !month || date.startsWith(month);

    const week = document.getElementById('week-filter').value;
    let matchWeek = true;
    if (week) {
      const [wYear, wWeek] = week.split("-W");
      const d = new Date(date);
      const dYear = d.getFullYear();
      const jan1 = new Date(dYear, 0, 1);
      const days = Math.floor((d - jan1) / (24 * 60 * 60 * 1000));
      const dWeek = Math.ceil((days + jan1.getDay() + 1) / 7);
      matchWeek = (parseInt(wYear) === dYear && parseInt(wWeek) === dWeek);
    }

    row.style.display = matchSearch && matchDevice && matchStart && matchEnd && matchMonth && matchWeek ? "" : "none";
  });
}

function deleteRow(button) {
  const row = button.closest('tr');
  row.remove();
  saveData();
}

tableBody.addEventListener("input", function(e) {
  const cell = e.target;
  const row = cell.parentElement;
  const statusCellIndex = 10;
  if (row.cells[statusCellIndex] === cell) {
    const status = cell.textContent.trim();
    if (status === "ì™„ë£Œ") {
      row.className = "status-done";
    } else {
      row.className = "status-progress";
    }
    saveData();
  }
});

window.onload = loadData;
</script>

</body>
</html>
</div>
