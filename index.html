<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>TC ê³ ê° ë¬¸ì˜ì‚¬í•­</title>
<style>
  :root {
    --bg-main: #007BFF;
    --bg-wrapper: #cce7ff;
    --bg-header: #b3daff;
    --bg-table-head: #0056b3;
    --bg-table-body: #cce7ff;
    --font-color-header: #000000;
    --font-color-light: #ffffff;
    --border-color: #333333;
    --button-bg: #003f7f;
    --button-bg-hover: #002b5c;
  }

  body {
    background-color: var(--bg-main);
    font-family: sans-serif;
    margin: 15px;
  }

  #form-wrapper,
  #main-wrapper {
    background-color: var(--bg-wrapper);
    border: 3px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
  }

  #form-wrapper h2,
  #main-wrapper h2 {
    background-color: var(--bg-header);
    padding: 5px 10px;
    border-radius: 6px;
    color: var(--font-color-header);
  }

  form input,
  form select,
  form button {
    padding: 5px;
    margin: 5px 0;
    font-size: 14px;
  }

  fieldset {
    border: 1px solid var(--border-color);
    padding: 10px;
    margin-bottom: 10px;
  }

  legend {
    font-weight: bold;
  }

  .form-section {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .form-section input,
  .form-section select,
  .form-section button {
    flex: 1 1 30%;
    min-width: 100px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: center;
  }

  th {
    background-color: var(--bg-table-head);
    color: var(--font-color-light);
  }

  #filter-wrapper {
    background-color: var(--bg-wrapper);
    padding: 10px;
    border-radius: 6px;
  }

  #cs-table {
    background-color: var(--bg-table-body);
  }

  #cs-table thead {
    background-color: var(--bg-header);
  }

  .status-done {
    background-color: #ccffcc;
  }

  .status-progress {
    background-color: #fffbe6;
  }

  button {
    background-color: var(--button-bg);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 5px;
    cursor: pointer;
  }

  button:hover {
    background-color: var(--button-bg-hover);
  }

  #month-filter,
  #week-filter,
  #search-issue,
  #search-device {
    font-size: 13px;
    padding: 5px 8px;
    font-family: sans-serif;
  }

  #search-issue,
  #search-device {
    width: 200px;
  }

  td select {
    padding: 5px 8px;
    font-size: 13px;
    min-width: 50px;
  }

#main-wrapper {
  background-color: var(--bg-wrapper) !important;
  padding: 20px;
  margin: 0;
  border-radius: 10px;
  box-shadow: none;
}

#main-wrapper > * {
  background-color: var(--bg-wrapper) !important;
  border-radius: 0;
  margin: 0;
  padding: 0;
  box-shadow: none;
}
</style>
</head>
<body>
<div id="form-wrapper">
<h2>âœ’ï¸ë¬¸ì˜ì‚¬í•­ ë“±ë¡</h2>
<form id="cs-form">
<fieldset style="border: 1px solid #aaa; padding: 1px; margin-bottom: 0px;">
<legend>ìš”ì²­ì ì •ë³´</legend>
<input id="req-company" placeholder="ìš”ì²­ íšŒì‚¬" type="text"/>
<input id="req-name" placeholder="ìš”ì²­ìëª…" type="text"/>
<input id="req-phone" placeholder="ìš”ì²­ì ì „í™”ë²ˆí˜¸" type="text"/>
</fieldset>
<fieldset style="border: 1px solid #aaa; padding: 1px; margin-bottom: 0px;">
<legend>ê³ ê°ì‚¬ ì •ë³´</legend>
<input id="client-company" placeholder="ê³ ê°ì‚¬" type="text"/>
<input id="client-name" placeholder="ê³ ê°ëª…" type="text"/>
<input id="client-phone" placeholder="ê³ ê°ì‚¬ ì „í™”ë²ˆí˜¸" type="text"/>
</fieldset>
<fieldset style="border: 1px solid #aaa; padding: 1px; margin-bottom: 0px;">
<legend>ì´ìŠˆ ì •ë³´</legend>
<input id="device" placeholder="ì¥ë¹„ëª…" type="text"/>
<input id="issue" placeholder="ì´ìŠˆ ë‚´ìš©" type="text"/>
<input id="response" placeholder="ëŒ€ì‘ ë‚´ìš©" type="text"/>
<select id="status"><option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option><option value="ì™„ë£Œ">ì™„ë£Œ</option></select>
<input id="input-date" type="date"/>
<input accept=".txt" id="attachment" type="file"/>
<button type="submit">ë“±ë¡</button>
</fieldset>
</form>
</div>
<div id="main-wrapper">
<div id="filter-wrapper">
<label for="month-filter">ì›”ë³„ ì¡°íšŒ: 
  <select id="month-filter" onchange="filterTable()">
<option value="">ì „ì²´</option>
<option value="2025-01">2025ë…„ 1ì›”</option>
<option value="2025-02">2025ë…„ 2ì›”</option>
<option value="2025-03">2025ë…„ 3ì›”</option>
<option value="2025-04">2025ë…„ 4ì›”</option>
<option value="2025-05">2025ë…„ 5ì›”</option>
<option value="2025-06">2025ë…„ 6ì›”</option>
<option value="2025-07">2025ë…„ 7ì›”</option>
<option value="2025-08">2025ë…„ 8ì›”</option>
<option value="2025-09">2025ë…„ 9ì›”</option>
<option value="2025-10">2025ë…„ 10ì›”</option>
<option value="2025-11">2025ë…„ 11ì›”</option>
<option value="2025-12">2025ë…„ 12ì›”</option>
</select>
</label>
<label for="week-filter" style="margin-left: 20px;">ì£¼ë³„ ì¡°íšŒ: 
  <input id="week-filter" onchange="filterTable()" type="week"/>
</label>
<h2>ğŸ“‹ ë¬¸ì˜ì‚¬í•­ ë‚´ì—­</h2>
<div id="filter-section">
<input id="search-issue" placeholder="ì´ìŠˆ ë‚´ìš© ê²€ìƒ‰" type="text"/>
<input id="search-device" placeholder="ì¥ë¹„ëª… ê²€ìƒ‰" type="text"/>
<button onclick="filterTable()">ğŸ” ê²€ìƒ‰</button>
<label>ì‹œì‘ì¼: <input id="start-date" type="date"/></label>
<label>ì¢…ë£Œì¼: <input id="end-date" type="date"/></label>
<button onclick="downloadExcel()">ğŸ“¤ Excel ë‹¤ìš´ë¡œë“œ</button>
</div>
<table id="cs-table">
<thead>
<tr>
<th>ë‚ ì§œ</th>
<th>ìš”ì²­ íšŒì‚¬</th>
<th>ìš”ì²­ìëª…</th>
<th>ìš”ì²­ì ì „í™”ë²ˆí˜¸</th>
<th>ê³ ê°ì‚¬</th>
<th>ê³ ê°ëª…</th>
<th>ê³ ê°ì‚¬ ì „í™”ë²ˆí˜¸</th>
<th>ì¥ë¹„ëª…</th>
<th>ì´ìŠˆ ë‚´ìš©</th>
<th>ëŒ€ì‘ ë‚´ìš©</th>
<th>Tech-support</th>
<th>ì²˜ë¦¬ ì—¬ë¶€</th>
<th>ì‚­ì œ</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<script>
const form = document.getElementById('cs-form');
const tableBody = document.querySelector('#cs-table tbody');
const searchInput = document.getElementById('search-issue');
const startDateInput = document.getElementById('start-date');
const endDateInput = document.getElementById('end-date');
const LOCAL_KEY = "cs_data";

// [ìˆ˜ì •ë¨] 1. ìƒˆ í•­ëª© ë“±ë¡ ê¸°ëŠ¥ (íŒŒì¼ ì²˜ë¦¬ ë¡œì§ í¬í•¨)
form.addEventListener('submit', function (e) {
  e.preventDefault();

  const fileInput = document.getElementById("attachment");
  const file = fileInput.files[0];
  let fileName = file ? file.name : "ì—†ìŒ"; // íŒŒì¼ì´ ìˆìœ¼ë©´ íŒŒì¼ëª…, ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´

  const reqCompany = document.getElementById('req-company').value || '-';
  const reqName = document.getElementById('req-name').value || '-';
  const reqPhone = document.getElementById('req-phone').value || '-';
  const cliCompany = document.getElementById('client-company').value || '-';
  const cliName = document.getElementById('client-name').value || '-';
  const cliPhone = document.getElementById('client-phone').value || '-';
  const device = document.getElementById('device').value || '-';
  const issue = document.getElementById('issue').value || '-';
  const response = document.getElementById('response').value || '-';
  const status = document.getElementById('status').value;
  const dateInput = document.getElementById('input-date').value;
  const date = dateInput ? dateInput : new Date().toISOString().split('T')[0];

  const newRowData = [
      date, reqCompany, reqName, reqPhone,
      cliCompany, cliName, cliPhone,
      device, issue, response, fileName, status
  ];

  createRow(newRowData); // í–‰ ìƒì„± í•¨ìˆ˜ í˜¸ì¶œ
  saveData();
  form.reset();
  filterTable();
});

// [ìˆ˜ì •ë¨] 2. í‘œì— ìƒˆë¡œìš´ í–‰ì„ ìƒì„±í•˜ê³  ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
function createRow(entry) {
    const status = entry[11]; // ë°ì´í„° ë°°ì—´ì—ì„œ ìƒíƒœ ê°’ ê°€ì ¸ì˜¤ê¸°
    const newRow = document.createElement('tr');
    newRow.className = status === "ì™„ë£Œ" ? "status-done" : "status-progress";
    newRow.innerHTML = `
      <td>${entry[0]}</td>
      <td contenteditable="true">${entry[1]}</td>
      <td contenteditable="true">${entry[2]}</td>
      <td contenteditable="true">${entry[3]}</td>
      <td contenteditable="true">${entry[4]}</td>
      <td contenteditable="true">${entry[5]}</td>
      <td contenteditable="true">${entry[6]}</td>
      <td contenteditable="true">${entry[7]}</td>
      <td contenteditable="true">${entry[8]}</td>
      <td contenteditable="true">${entry[9]}</td>
      <td contenteditable="true">${entry[10]}</td>
      <td>
        <select onchange="updateStatus(this)">
          <option value="ì§„í–‰ì¤‘" ${status === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
          <option value="ì™„ë£Œ" ${status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
        </select>
      </td>
      <td><button onclick="deleteRow(this)">ì‚­ì œ</button></td>
    `;
    tableBody.appendChild(newRow);
}

// [ìˆ˜ì •ë¨] 3. ìƒíƒœ ë³€ê²½ ì‹œ í´ë˜ìŠ¤ ë³€ê²½ ë° ë°ì´í„° ì €ì¥
function updateStatus(selectElement) {
  const row = selectElement.closest("tr");
  row.className = selectElement.value === "ì™„ë£Œ" ? "status-done" : "status-progress";
  saveData(); // ìƒíƒœ ë³€ê²½ í›„ ì¦‰ì‹œ ì €ì¥
}

// [ìˆ˜ì •ë¨] 4. í…Œì´ë¸”ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
function saveData() {
  const rows = Array.from(tableBody.children).map(row => {
    const statusSelect = row.cells[11].querySelector('select');
    return [
      row.cells[0].textContent, // ë‚ ì§œ
      row.cells[1].textContent, // ìš”ì²­ íšŒì‚¬
      row.cells[2].textContent, // ìš”ì²­ìëª…
      row.cells[3].textContent, // ìš”ì²­ì ì „í™”ë²ˆí˜¸
      row.cells[4].textContent, // ê³ ê°ì‚¬
      row.cells[5].textContent, // ê³ ê°ëª…
      row.cells[6].textContent, // ê³ ê°ì‚¬ ì „í™”ë²ˆí˜¸
      row.cells[7].textContent, // ì¥ë¹„ëª…
      row.cells[8].textContent, // ì´ìŠˆ ë‚´ìš©
      row.cells[9].textContent, // ëŒ€ì‘ ë‚´ìš©
      row.cells[10].textContent, // Tech-support (íŒŒì¼ëª…)
      statusSelect ? statusSelect.value : 'ì§„í–‰ì¤‘' // ì²˜ë¦¬ ì—¬ë¶€
    ];
  });
  localStorage.setItem(LOCAL_KEY, JSON.stringify(rows));
}

// [ìˆ˜ì •ë¨] 5. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ í…Œì´ë¸”ì„ ì±„ìš°ëŠ” í•¨ìˆ˜
function loadData() {
  const data = JSON.parse(localStorage.getItem(LOCAL_KEY) || "[]");
  data.forEach(entry => createRow(entry)); // ê° ë°ì´í„°ì— ëŒ€í•´ í–‰ ìƒì„± í•¨ìˆ˜ í˜¸ì¶œ
  filterTable(); // ë°ì´í„° ë¡œë“œ í›„ í•„í„° ì ìš©
}

// [ì •ìƒ ì‘ë™] 6. í•„í„°ë§ ê¸°ëŠ¥ (ìˆ˜ì • í•„ìš” ì—†ìŒ)
function filterTable() {
  const search = searchInput.value.toLowerCase().trim();
  const searchDevice = document.getElementById('search-device').value.toLowerCase().trim();
  const start = startDateInput.value;
  const end = endDateInput.value;
  const month = document.getElementById('month-filter').value;
  const week = document.getElementById('week-filter').value;

  Array.from(tableBody.rows).forEach(row => {
    const date = row.cells[0].textContent;
    const device = row.cells[7].textContent.toLowerCase();
    const issue = row.cells[8].textContent.toLowerCase();
    
    const matchSearch = issue.includes(search);
    const matchDevice = device.includes(searchDevice);
    const matchStart = !start || date >= start;
    const matchEnd = !end || date <= end;
    const matchMonth = !month || date.startsWith(month);

    let matchWeek = true;
    if (week) {
      const [wYear, wWeekStr] = week.split("-W");
      const wWeek = parseInt(wWeekStr);
      const d = new Date(date);
      const dYear = d.getFullYear();
      const jan1 = new Date(dYear, 0, 1);
      const days = Math.floor((d - jan1) / (24 * 60 * 60 * 1000));
      const dWeek = Math.ceil((days + jan1.getDay() + 1) / 7);
      matchWeek = (parseInt(wYear) === dYear && wWeek === dWeek);
    }

    row.style.display = matchSearch && matchDevice && matchStart && matchEnd && matchMonth && matchWeek ? "" : "none";
  });
}

// [ì •ìƒ ì‘ë™] 7. í–‰ ì‚­ì œ ê¸°ëŠ¥
function deleteRow(button) {
  const row = button.closest('tr');
  row.remove();
  saveData();
}

// [ìˆ˜ì •ë¨] 8. ì¸ë¼ì¸ í¸ì§‘ ì‹œ ìë™ ì €ì¥ì„ ìœ„í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
tableBody.addEventListener("input", function(e) {
  // contenteditable ì†ì„±ì´ ìˆëŠ” ì…€ì—ì„œ 'input' ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ë°”ë¡œ ì €ì¥
  if (e.target.hasAttribute('contenteditable')) {
    saveData();
  }
});

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
window.onload = loadData;
</script>
</div></body>
</html>
